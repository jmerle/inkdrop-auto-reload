{"version":3,"sources":["../src/index.js"],"names":["watcher","reloadCalled","doReload","inkdrop","commands","add","document","body","window","reload","dispatch","path","packageName","exec","disabled","packages","isPackageDisabled","reloadDisabled","config","get","reloadImmediately","focused","isFocused","once","title","description","type","default","activate","chokidar","watch","getPackageDirPaths","ignoreInitial","ignored","includes","on","deactivate","close"],"mappings":";;;;;;;;;AAAA;;;;AAEA,IAAIA,OAAO,GAAG,IAAd;AACA,IAAIC,YAAY,GAAG,KAAnB;;AAEA,SAASC,QAAT,GAAoB;AAClBC,EAAAA,OAAO,CAACC,QAAR,CAAiBC,GAAjB,CAAqBC,QAAQ,CAACC,IAA9B,EAAoC;AAClC,sBAAkB,MAAMJ,OAAO,CAACK,MAAR,CAAeC,MAAf;AADU,GAApC;AAIAN,EAAAA,OAAO,CAACC,QAAR,CAAiBM,QAAjB,CAA0BJ,QAAQ,CAACC,IAAnC,EAAyC,gBAAzC;AACD;;AAED,SAASE,MAAT,CAAgBE,IAAhB,EAAsB;AACpB,MAAIV,YAAJ,EAAkB;AAChB;AACD;;AAED,QAAMW,WAAW,GAAG,sBAAsBC,IAAtB,CAA2BF,IAA3B,EAAiC,CAAjC,CAApB;AACA,QAAMG,QAAQ,GAAGX,OAAO,CAACY,QAAR,CAAiBC,iBAAjB,CAAmCJ,WAAnC,CAAjB;AACA,QAAMK,cAAc,GAAGd,OAAO,CAACe,MAAR,CAAeC,GAAf,CAAmB,4BAAnB,CAAvB;;AAEA,MAAIL,QAAQ,IAAI,CAACG,cAAjB,EAAiC;AAC/B;AACD;;AAEDhB,EAAAA,YAAY,GAAG,IAAf;AAEA,QAAMmB,iBAAiB,GAAGjB,OAAO,CAACe,MAAR,CAAeC,GAAf,CAAmB,+BAAnB,CAA1B;AACA,QAAME,OAAO,GAAGlB,OAAO,CAACK,MAAR,CAAec,SAAf,EAAhB;;AAEA,MAAIF,iBAAiB,IAAIC,OAAzB,EAAkC;AAChCnB,IAAAA,QAAQ;AACT,GAFD,MAEO;AACLC,IAAAA,OAAO,CAACK,MAAR,CAAee,IAAf,CAAoB,OAApB,EAA6B,MAAM;AACjCrB,MAAAA,QAAQ;AACT,KAFD;AAGD;AACF;;AAEM,MAAMgB,MAAM,GAAG;AACpBE,EAAAA,iBAAiB,EAAE;AACjBI,IAAAA,KAAK,EAAE,oDADU;AAEjBC,IAAAA,WAAW,EACT,kKAHe;AAIjBC,IAAAA,IAAI,EAAE,SAJW;AAKjBC,IAAAA,OAAO,EAAE;AALQ,GADC;AAQpBV,EAAAA,cAAc,EAAE;AACdO,IAAAA,KAAK,EAAE,6DADO;AAEdE,IAAAA,IAAI,EAAE,SAFQ;AAGdC,IAAAA,OAAO,EAAE;AAHK;AARI,CAAf;;;AAeA,SAASC,QAAT,GAAoB;AACzB5B,EAAAA,OAAO,GAAG6B,kBAASC,KAAT,CAAe3B,OAAO,CAACY,QAAR,CAAiBgB,kBAAjB,EAAf,EAAsD;AAC9DC,IAAAA,aAAa,EAAE,IAD+C;AAE9DC,IAAAA,OAAO,EAAEtB,IAAI,IAAIA,IAAI,CAACuB,QAAL,CAAc,OAAd,KAA0BvB,IAAI,CAACuB,QAAL,CAAc,eAAd;AAFmB,GAAtD,CAAV;AAKAlC,EAAAA,OAAO,CACJmC,EADH,CACM,KADN,EACaxB,IAAI,IAAIF,MAAM,CAACE,IAAD,CAD3B,EAEGwB,EAFH,CAEM,QAFN,EAEgBxB,IAAI,IAAIF,MAAM,CAACE,IAAD,CAF9B,EAGGwB,EAHH,CAGM,QAHN,EAGgBxB,IAAI,IAAIF,MAAM,CAACE,IAAD,CAH9B;AAID;;AAEM,SAASyB,UAAT,GAAsB;AAC3B,MAAIpC,OAAO,KAAK,IAAhB,EAAsB;AACpBA,IAAAA,OAAO,CAACqC,KAAR;AACArC,IAAAA,OAAO,GAAG,IAAV;AACD;AACF","sourcesContent":["import chokidar from 'chokidar';\n\nlet watcher = null;\nlet reloadCalled = false;\n\nfunction doReload() {\n  inkdrop.commands.add(document.body, {\n    'core:save-note': () => inkdrop.window.reload(),\n  });\n\n  inkdrop.commands.dispatch(document.body, 'core:save-note');\n}\n\nfunction reload(path) {\n  if (reloadCalled) {\n    return;\n  }\n\n  const packageName = /packages\\/([^/\\\\]+)/.exec(path)[1];\n  const disabled = inkdrop.packages.isPackageDisabled(packageName);\n  const reloadDisabled = inkdrop.config.get('auto-reload.reloadDisabled');\n\n  if (disabled && !reloadDisabled) {\n    return;\n  }\n\n  reloadCalled = true;\n\n  const reloadImmediately = inkdrop.config.get('auto-reload.reloadImmediately');\n  const focused = inkdrop.window.isFocused();\n\n  if (reloadImmediately || focused) {\n    doReload();\n  } else {\n    inkdrop.window.once('focus', () => {\n      doReload();\n    });\n  }\n}\n\nexport const config = {\n  reloadImmediately: {\n    title: 'Reload immediately when a change has been detected',\n    description:\n      'When disabled reloading is postponed until Inkdrop is given focus. Reloading causes Inkdrop to steal focus from other applications, which can be quite annoying.',\n    type: 'boolean',\n    default: false,\n  },\n  reloadDisabled: {\n    title: 'Reload when a change in a disabled plugin has been detected',\n    type: 'boolean',\n    default: false,\n  },\n};\n\nexport function activate() {\n  watcher = chokidar.watch(inkdrop.packages.getPackageDirPaths(), {\n    ignoreInitial: true,\n    ignored: path => path.includes('.git/') || path.includes('node_modules/'),\n  });\n\n  watcher\n    .on('add', path => reload(path))\n    .on('change', path => reload(path))\n    .on('unlink', path => reload(path));\n}\n\nexport function deactivate() {\n  if (watcher !== null) {\n    watcher.close();\n    watcher = null;\n  }\n}\n"],"file":"index.js"}